<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="ccsss" name="author"/>
<link href="https://ccss17.github.io/security-tutorial/06-Exploit1/" rel="canonical"/>
<link href="../../assets/images/bolt-solid.svg" rel="icon"/>
<meta content="mkdocs-1.2.2, mkdocs-material-7.2.6" name="generator"/>
<title>Day6 Exploit 1 - ccss17</title>
<link href="../../assets/stylesheets/main.802231af.min.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/palette.3f5d1f46.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Nanum+Gothic:300,400,400i,700%7C&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font-family:"Nanum Gothic";--md-code-font-family:""}</style>
<link href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css" rel="stylesheet"/>
<link href="../../stylesheets/config.css" rel="stylesheet"/>
</head>
<body data-md-color-accent="" data-md-color-primary="white" data-md-color-scheme="default" dir="ltr">
<script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
<script>var palette=__get("__palette");if(null!==palette&&"object"==typeof palette.color)for(var key in palette.color)document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#_1">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="ccss17" class="md-header__button md-logo" data-md-component="logo" href="../.." title="ccss17">
<img alt="logo" src="../../assets/images/bolt-solid.svg"/>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            ccss17
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Day6 Exploit 1
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="" data-md-color-media="" data-md-color-primary="white" data-md-color-scheme="default" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_2" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="" data-md-color-media="" data-md-color-primary="deep-purple" data-md-color-scheme="slate" id="__palette_2" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1z"></path></svg>
</label>
</form>
</nav>
</header>
<div class="md-container" data-md-component="container">
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-tabs__inner md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="../..">
      ccss17
    </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../Math/MathHistory/">
        Math
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../paper/1404.6388/">
        Paper
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../Computer/nand2tetris/">
        Computer
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../ProgrammerBase/">
        ProgrammerBase
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link md-tabs__link--active" href="../">
        security tutorial
      </a>
</li>
</ul>
</div>
</nav>
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="ccss17" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="ccss17">
<img alt="logo" src="../../assets/images/bolt-solid.svg"/>
</a>
    ccss17
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../..">
        ccss17
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2">
        Math
        <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Math" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
          Math
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_1" id="__nav_2_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_1">
        Foundation of Math
        <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Foundation of Math" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_1">
<span class="md-nav__icon md-icon"></span>
          Foundation of Math
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../Math/MathHistory/">
        History of Math
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Math/Logic/FormalSystem/">
        Formal System
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Math/incompleteness/">
        Incompleteness theorem
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Math/turing/">
        Turing's proof
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Math/gentzen/">
        Consistency proof of Peano arithmetic
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_2" id="__nav_2_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_2">
        Set Theory
        <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Set Theory" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_2">
<span class="md-nav__icon md-icon"></span>
          Set Theory
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../Math/Set/Set/">
        Set
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Math/Set/numbers/">
        Number Theory
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Math/Set/InfiniteSet/">
        Infinite Set
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Math/Set/ZFC/">
        ZFC axiom system
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Math/ArithmeticOperations/">
        Arithmetic Operations
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Math/Polynomials/">
        Polynomials
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Math/HyperrealNumbers/">
        Hyperreal Numbers
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Math/SurrealNumbers/">
        Surreal Numbers
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_7" id="__nav_2_7" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_7">
        Linear Algebra
        <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Linear Algebra" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_7">
<span class="md-nav__icon md-icon"></span>
          Linear Algebra
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../Math/LinearAlgebra/VectorSpace/">
        Vector Space
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Math/LinearAlgebra/LinearTransformation/">
        Linear Transformation
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Math/LinearAlgebra/MatrixOperation/">
        Matrix Operation
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Math/LinearAlgebra/Determinants/">
        Determinants
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Math/LinearAlgebra/Diagonalization/">
        Diagonalization
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Math/LinearAlgebra/InnerProductSpaces/">
        Inner Product Spaces
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Math/LinearAlgebra/CanonicalForms/">
        Canonical Forms
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3">
        Paper
        <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Paper" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
          Paper
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../paper/1404.6388/">
        Performance of Python runtimes on a non-numeric scientific code
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../paper/1102.1523/">
        The NumPy array: a structure for efficient numerical computation
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../paper/facenet/">
        Facenet (2015)
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../paper/quadruplet/">
        Quadruplet (2017)
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../paper/blueborne/">
        BlueBorne
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4">
        Computer
        <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Computer" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
          Computer
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../Computer/nand2tetris/">
        Nand to Tetris
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Computer/future/">
        Why the future doesn't need us
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Computer/Rust/">
        Rust Memo
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" id="__nav_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5">
        ProgrammerBase
        <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="ProgrammerBase" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
          ProgrammerBase
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../ProgrammerBase/">
        README
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_2" id="__nav_5_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_2">
        Contents
        <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Contents" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_2">
<span class="md-nav__icon md-icon"></span>
          Contents
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../ProgrammerBase/01-Day1/readme/">
        Day 1
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../ProgrammerBase/02-Day2/readme/">
        Day 2
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../ProgrammerBase/03-Day3/readme/">
        Day 3
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../ProgrammerBase/04-Day4/readme/">
        Day 4
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../ProgrammerBase/05-Day5/readme/">
        Day 5
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../ProgrammerBase/docker/">
        Docker
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../ProgrammerBase/codingconvention/">
        Coding Convention
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../ProgrammerBase/build/">
        Build System
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../ProgrammerBase/information/">
        Information
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../ProgrammerBase/git/">
        Git
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../ProgrammerBase/vscode/">
        VSCode
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../ProgrammerBase/markdown/">
        Markdown
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../ProgrammerBase/tmux/">
        Tmux
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../ProgrammerBase/vim/">
        Vim
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../ProgrammerBase/cli/">
        CLI
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" id="__nav_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_6">
        security tutorial
        <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="security tutorial" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_6">
<span class="md-nav__icon md-icon"></span>
          security tutorial
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../">
        README
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../01-Base/">
        Day1 Base
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../02-Computer1/">
        Day2 Computer Principle 1
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../03-Computer2/">
        Day3 Computer Principle 2
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../04-Reversing1/">
        Day4 Reversing 1
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../05-Reversing2/">
        Day5 Reversing 2
      </a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" data-md-toggle="toc" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
          Day6 Exploit 1
          <span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
        Day6 Exploit 1
      </a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<!-- <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label> -->
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#_1">
    함수의 시작(스택 메모리 공간 생성하기)
  </a>
<nav aria-label="함수의 시작(스택 메모리 공간 생성하기)" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_2">
    함수의 끝 (스택 메모리 공간 정리하기)
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#exploit-1">
    Exploit (1)
  </a>
<nav aria-label="Exploit (1)" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_3">
    지금까지 했던 리버싱의 의미
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_4">
    리눅스 특수 권한
  </a>
<nav aria-label="리눅스 특수 권한" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_5">
    특수 권한 파일의 의미
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_6">
    특수 권한 파일 검색
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_7">
    프로그램의 흐름을 조작하는 가장 기초적인 방법
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#buffer-overflow">
    Buffer Overflow
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#bof1">
    bof1 설명
  </a>
<nav aria-label="bof1 설명" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#buf-innocent">
    buf 와 innocent 사이의 거리
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#innocent">
    innocent 변수 조작하기
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_8">
    파이프 | 와 입력 스트림
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_9">
    만약 메인함수 인자로 입력을 받는다면?
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#bof2-bof4">
    bof2 ~ bof4 풀어보기
  </a>
<nav aria-label="bof2 ~ bof4 풀어보기" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_10">
    과제
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../07-Exploit2/">
        Day7 Exploit 2
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../08-Exploit3/">
        Day8 Exploit 3
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../09-Exploit4/">
        Day9 Exploit 4
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../10-Pentesting/">
        Day10 Pentesting
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<!-- <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label> -->
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#_1">
    함수의 시작(스택 메모리 공간 생성하기)
  </a>
<nav aria-label="함수의 시작(스택 메모리 공간 생성하기)" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_2">
    함수의 끝 (스택 메모리 공간 정리하기)
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#exploit-1">
    Exploit (1)
  </a>
<nav aria-label="Exploit (1)" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_3">
    지금까지 했던 리버싱의 의미
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_4">
    리눅스 특수 권한
  </a>
<nav aria-label="리눅스 특수 권한" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_5">
    특수 권한 파일의 의미
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_6">
    특수 권한 파일 검색
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_7">
    프로그램의 흐름을 조작하는 가장 기초적인 방법
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#buffer-overflow">
    Buffer Overflow
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#bof1">
    bof1 설명
  </a>
<nav aria-label="bof1 설명" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#buf-innocent">
    buf 와 innocent 사이의 거리
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#innocent">
    innocent 변수 조작하기
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_8">
    파이프 | 와 입력 스트림
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_9">
    만약 메인함수 인자로 입력을 받는다면?
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#bof2-bof4">
    bof2 ~ bof4 풀어보기
  </a>
<nav aria-label="bof2 ~ bof4 풀어보기" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_10">
    과제
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1>Day6 Exploit 1</h1>
<h2 id="_1">함수의 시작(스택 메모리 공간 생성하기)<a class="headerlink" href="#_1" title="Permanent link">¶</a></h2>
<ul>
<li>
<p>함수가 호출 될 때 이전 함수의 스택 베이스 주소를 복원하기 위해서 rbp 를 push 해서 스택에 저장해둔다. 위와 같은 경우 main 함수가 add 함수를 호출하고 있는데 add 함수가 스택을 사용하기 전에 main 함수에서 사용하던 스택 베이스 주소, 즉 rbp 에 있던 값을 스택에 저장해서 main 함수의 스택을 복원해야 할 때를 대비한다. </p>
<div class="highlight"><pre><span></span><code>push rbp        ; 이전에 있던 함수의 rbp 를 스택에 저장
mov rbp, rsp    ; 스택의 베이스 주소를 스택의 탑 주소와 같게 만듦. 이 시점에서 스택의 크기는 최소 단위 8 바이트가 됨
sub rsp, 0x60   ; 스택의 크기를 0x60 만큼 늘려줌 
</code></pre></div>
<p><img alt="stack-return" src="https://user-images.githubusercontent.com/16812446/72771299-d9a27700-3c43-11ea-87c1-0d3f322b6163.PNG"/></p>
</li>
<li>
<p>그래서 일반적인 함수는 위와 같은 어셈블리 코드로 시작된다. </p>
</li>
</ul>
<h3 id="_2">함수의 끝 (스택 메모리 공간 정리하기)<a class="headerlink" href="#_2" title="Permanent link">¶</a></h3>
<ul>
<li>
<p>함수가 일을 다 마치고 원래의 함수로 되돌아 가야 할 때는 위와 같은 어셈블리 코드로 늘려 놓은 스택을 되돌린 후 이전 함수의 rbp 를 복원한다. 이를 이해 다음과 같은 명령어를 사용한다.</p>
<div class="highlight"><pre><span></span><code>leave
ret
</code></pre></div>
</li>
<li>
<p>늘려진 스택을 줄이고 원래 함수의 스택 베이스 주소를 복원하는 용도로 leave 명령어가 사용된다. leave 명령어는 다음의 코드와 같은 기능을 한다.</p>
<div class="highlight"><pre><span></span><code>mov rsp, rbp    ; rsp 에 rbp 를 대입해서 늘어난 스택을 다시 크기가 최소 단위인 8 바이트 스택으로 만든다. 
pop rbp         ; pop 명령으로 그곳에 남아있던 원래의 함수의 스택 베이스 주소를 rbp 에 복원시킨다. 
</code></pre></div>
</li>
</ul>
<h2 id="exploit-1">Exploit (1)<a class="headerlink" href="#exploit-1" title="Permanent link">¶</a></h2>
<h3 id="_3">지금까지 했던 리버싱의 의미<a class="headerlink" href="#_3" title="Permanent link">¶</a></h3>
<p>지금까지 했던 리버싱은 비밀번호를 요구하는 프로그램을 해킹하는 것이었다. 입력한 값의 비밀번호를 판정하는 분기를 역추적하여 분기를 결정하는 조건을 이해하고 그 분기를 조작하는 것인데, 실제 해킹에서도 해커의 목표에 따른 분기점을 역공학으로 분석한 후 분기를 조작하는 것이다. </p>
<ul>
<li>
<p>현금 인출기에서 돈을 인출하는 분기를 조작 : <a href="https://www.youtube.com/watch?v=li08Tw9MjZI">https://www.youtube.com/watch?v=li08Tw9MjZI</a></p>
</li>
<li>
<p>게임 속 캐릭터를 보이게 하는 분기 조작 : <a href="https://youtu.be/6JmkmmJ4qgU?t=429">https://youtu.be/6JmkmmJ4qgU?t=429</a></p>
</li>
</ul>
<h3 id="_4">리눅스 특수 권한<a class="headerlink" href="#_4" title="Permanent link">¶</a></h3>
<p><a href="https://eunguru.tistory.com/115">https://eunguru.tistory.com/115</a></p>
<h4 id="_5">특수 권한 파일의 의미<a class="headerlink" href="#_5" title="Permanent link">¶</a></h4>
<p>해커가 서버에 접근하는 것은 웹 취약점이나 어플리케이션 취약점을 통해 접근하는 것이지만 정작 서버에 명령을 내리고 싶어도 권한이 없으면 명령을 내릴 수 없다. 그래서 권한 상승이 필요한데 그 권한 상승의 방법 중 하나가 setuid 가 설정된 파일을 사용하여 명령을 내리는 것이다. 다음 그림을 보자. </p>
<p><img alt="program" src="https://user-images.githubusercontent.com/16812446/72771724-23d82800-3c45-11ea-9849-6bb5269e740f.png"/></p>
<p>컴퓨터가 프로그램을 실행할 때는 다음과 같이 실행한 프로그램이 현재 디렉토리에 있는지 확인한다. 만약 없다면 환경 변수의 <code>PATH</code> 의 경로에 있는 디렉토리를 모두 뒤져서 프로그램이 있는지 확인한다.</p>
<p>결국 프로그램이 있다면 이제 실행한 사용자에게 실행권한이 있는지 확인한다. 만약 실행권한이 없다면 프로그램에 <code>setuid</code> 특수권한이 설정되어 있는지 확인한다. 특수권한이 없다면 프로그램 실행은 최종적으로 기각되고 특수권한이 있다면 그 권한으로 프로그램이 실행된다. </p>
<p>해커 입장에서는 이미 권한이 있는 프로그램을 해킹해봤자 아무런 의미가 없다. 자기 자신의 금고를 자기가 따봤자 아무런 의미가 없는 것과 마찬가지이다. 해커는 권한이 상승된 프로그램을 해킹하고 프로그램의 실행흐름을 조작하여 자신이 원하는 어셈블리어들을 실행하길 원한다. 위에서 현금 인출기를 해킹한 예시로 따지면 <strong>"현금 인출기 권한을 가진 프로그램"</strong> 을 해킹해야지 프로그램의 실행 흐름을 "무차별적으로 돈을 인출하는 어셈블리어를 실행"하는 곳으로 바꿔 버릴 수 있는 것이다. </p>
<h4 id="_6">특수 권한 파일 검색<a class="headerlink" href="#_6" title="Permanent link">¶</a></h4>
<p>그러므로 어떤 시스템에 침투하는 것을 성공했다면 먼저 특수 권한이 설정된 프로그램을 찾아보자. 다음 명령어로 특수권한이 설정된 프로그램을 찾을 수 있다. </p>
<ul>
<li>
<p>setuid 비트 : <code>find /tmp/test -perm -4000 -ls</code></p>
</li>
<li>
<p>setgid 비트 : <code>find /tmp/test -perm -2000 -ls</code></p>
</li>
<li>
<p>sticky 비트 : <code>find /tmp/test -perm -1000 -ls</code></p>
</li>
</ul>
<h3 id="_7">프로그램의 흐름을 조작하는 가장 기초적인 방법<a class="headerlink" href="#_7" title="Permanent link">¶</a></h3>
<p>해킹에 대한 정의를 일단은 <strong>리버싱을 통해 프로그램의 작동방식</strong> 을 알아낸 후 <strong>그 작동방식을 조작하는</strong> 것이라고 내리자. </p>
<p>바로 그 작동방식을 조작하는 가장 기초적인 방법 중 하나가 <strong>Buffer Overflow(BOF)</strong> 이다. 한 마디로 권한이 없는 프로그램을 마음대로 다룰 수 있다는 것인데 <strong>BOF</strong> 로 어떻게 그것이 가능한지 알아보자. </p>
<p><img alt="BOF" src="http://www.cbi.umn.edu/securitywiki/pub/CBI_ComputerSecurity/DraftCanaries/buffer-overflow---canary-copy.png"/></p>
<p>프로세스가 메모리에 할당될 때 위와 같이 메모리 구조가 형성된다. 만약 버퍼에 입력을 받는 프로그램일 경우 사용자가 버퍼에 입력할 데이터의 길이를 반드시 체크해야 한다. 그렇지 않으면 어떤 사용자가 버퍼에 데이터를 마음대로 넣어서 <strong>스택 맨 위에 있는 프로그램의 리턴 주소값 또한 덮어 쓸 수 있</strong> 기 때문이다. 리턴 주소를 조작한다는 의미는 프로그램의 흐름을 바꾼다는 뜻이고, 프로그램의 흐름을 맘대로 바꿀 수 있다는 의미는 해킹 할 수 있다는 의미이다. </p>
<p><img alt="BOF2" src="http://www.securitysift.com/wp-content/uploads/2013/12/strcpy_bof_diagram.png"/></p>
<p>위 그림처럼 사용자가 입력하는 데이터의 길이를 검사하지 않을 경우 사용자가 <code>A</code> 를 한도끝도 없이 입력할 수 있다. 그러면 컴퓨터는 정직하게 그대로 스택에 덮어쓰는데 이 경우 리턴 주소값이 <code>A</code> 의 아스키 코드 값인 <code>0x41</code> 로 덮어쓰여져서 <code>0x4141414141414141</code> 이 될 것이다. </p>
<hr/>
<h2 id="buffer-overflow">Buffer Overflow<a class="headerlink" href="#buffer-overflow" title="Permanent link">¶</a></h2>
<h2 id="bof1">bof1 설명<a class="headerlink" href="#bof1" title="Permanent link">¶</a></h2>
<p>그런 다음 <code>bof1</code> 유저로 접속합니다. 비밀번호는 <code>bof1</code> 입니다. </p>
<p><img alt="" src="https://user-images.githubusercontent.com/16812446/72609259-d10e2000-3967-11ea-92ce-38b77e52282e.png"/></p>
<p>그러면 위와 같이 실행파일 <code>bof1</code> 과 소스코드 <code>bof1.c</code>, 그리고 <code>bof2</code> 의 비밀번호가 저장된 파일 <code>bof2.pw</code> 가 있습니다. </p>
<p><img alt="" src="https://user-images.githubusercontent.com/16812446/72609346-f69b2980-3967-11ea-8604-c44734794091.png"/></p>
<p>그런데 <code>bof2.pw</code> 는 권한이 없어 읽을 수 없습니다. </p>
<p><img alt="" src="https://user-images.githubusercontent.com/16812446/72609376-0ca8ea00-3968-11ea-8afb-7d2f041605dc.png"/></p>
<p>하지만 고맙게도 <code>bof1</code> 실행파일이 <code>bof2</code> 권한으로 실행되기 때문에 이 프로그램을 잘만 이용하면 <code>bof2.pw</code> 을 읽을 수 있을 것 같습니다. </p>
<p><img alt="" src="https://user-images.githubusercontent.com/16812446/72609483-627d9200-3968-11ea-910f-01c3333b564b.png"/></p>
<p><code>bof1</code> 의 소스코드를 살펴보니 위와 같습니다. <code>innocent</code> 변수를 <code>KEY</code> 와 비교하고 있는데 <code>KEY</code> 는 <code>0x61616161</code> 로 고정되어 있습니다. <code>innocent</code> 변수를 <code>0x61616161</code> 로 만들기만 하면 프로그램 권한인 <code>bof2</code> 로 쉘이 실행되서 <code>bof2.pw</code> 를 읽을 수 있습니다. </p>
<p>그런데 소스코드에서 <a href="https://www.tutorialspoint.com/c_standard_library/c_function_gets.htm"><code>gets</code> 함수</a>를 사용하고 있습니다. 대표적으로 <code>gets 함수</code>와 <a href="https://www.tutorialspoint.com/c_standard_library/c_function_strcpy"><code>strcpy 함수</code></a>는 입력받은 값을 버퍼에 저장할 때 입력 데이터의 길이를 검증하지 않고 단순히 입력 데이터를 스택에 복사하기만 합니다. 그렇기 때문에 정해진 버퍼의 길이를 초과해서 데이터를 전달해도 데이터가 그대로 스택에 복사된다. 이 프로그램은 <code>buf</code> 에 데이터를 <code>gest</code> 함수로 받아 저장하기 때문에 <code>buf</code> 에 저장될 수 있는 한계보다 더 큰 데이터를 입력하여 <code>innocent</code> 변수를 조작할 수 있습니다. </p>
<p>그런데 데이터를 얼마만큼 초과시켜야 <code>buf</code> 의 경계를 넘어서서 <code>innocent</code> 의 값을 조작할 수 있을까요? </p>
<h3 id="buf-innocent">buf 와 innocent 사이의 거리<a class="headerlink" href="#buf-innocent" title="Permanent link">¶</a></h3>
<p>다음과 같이 <code>gets</code> 까지 가서 <code>buf</code> 의 주소값을 확인한다 </p>
<p><img alt="gets" src="https://user-images.githubusercontent.com/16812446/72771461-4d448400-3c44-11ea-8524-4a8ac1334904.PNG"/></p>
<p><code>innocent</code> 와 <code>KEY</code> 를 비교하는 <code>cmp</code> 명령어까지 가서 <code>innocent</code> 의 주소값을 확인한다. </p>
<p><img alt="innocent" src="https://user-images.githubusercontent.com/16812446/72771478-56355580-3c44-11ea-8f7c-823d34ccb7b3.PNG"/></p>
<p><code>innocent</code> 가 <code>[rbp - 4]</code> 이다. </p>
<p><img alt="innocent_addr" src="https://user-images.githubusercontent.com/16812446/72771490-5d5c6380-3c44-11ea-9d1e-bdc0d9a845cf.PNG"/></p>
<p>그러면 이제 두 개의 주소값의 차이값을 구한다. 그 차이값이 <code>140</code> 이다.</p>
<p><img alt="distance" src="https://user-images.githubusercontent.com/16812446/72771501-6cdbac80-3c44-11ea-843e-3797069202d3.PNG"/></p>
<p><code>buf</code> 와 <code>innocent</code> 와의 거리가 <code>140</code> 인 것을 알았으니 데이터를 얼마나 초과해서 전달해야 <code>innocent</code> 를 덮어쓸 수 있는지 알게 되었다. </p>
<h3 id="innocent">innocent 변수 조작하기<a class="headerlink" href="#innocent" title="Permanent link">¶</a></h3>
<p>프로그램이 입력값을 표준입력으로부터 받는 경우이기 때문에 파이프 <code>|</code> 를 통해서 조작된 입력값을 전달할 수 있다. 보통의 경우 다음과 같이 입력값이 전달된다. </p>
<p><code>echo twice | ./bof</code></p>
<p>따라서 <code>innocent</code> 를 덮어쓰기 위해서는 쓰레기 값 140 바이트를 전달한 후 이후에 어떤 값을 입력하면 <code>innocent</code> 변수가 덮어씌워지게 된다. </p>
<div class="highlight"><pre><span></span><code>python -c <span class="s2">"print 'x'*140 + 'aaaa'"</span> <span class="p">|</span> ./bof
</code></pre></div>
<p>그런데 innocent 변수를 덮어썼을 때 쉘이 실행되기 때문에 입력 형태를 조금 바꾸어야 한다. </p>
<h3 id="_8">파이프 <code>|</code> 와 입력 스트림<a class="headerlink" href="#_8" title="Permanent link">¶</a></h3>
<p>표준 입력을 받는 프로그램은 키보드로부터의 입력이 끝날 때까지 입력을 받고 입력 스트림이 끝났을 때 프로그램을 종료한다. 예를 들어서 <code>bash</code> 라는 쉘 프로그램은 표준 입력(키보드)로부터 입력을 받는데 단일 실행을 했을 때 명시적으로 프로그램을 종료 시켜야지 프로그램이 끝난다. 왜냐하면 일반적으로 표준 입력 스트림은 종료되지 않기 때문이다. 하지만 파이프 <code>|</code> 를 통해 입력 스트림을 표준 입력이 아닌 다른 프로그램의 출력으로 리다이렉트 시키면 다른 프로그램이 끝났을 때 입력 스트림도 종료되기 때문에 프로그램이 종료된다. </p>
<div class="highlight"><pre><span></span><code><span class="nb">echo</span> ls <span class="p">|</span> bash
</code></pre></div>
<p>위의 명령어를 실행해보면 <code>bash</code> 쉘은 원래 실행 되었을 때 입력이 계속되는 한 종료되지 않지만 위와 같이 파이프 <code>|</code> 를 통해서 입력 스트림을 표준 입력에서 <code>echo ls</code> 라는 프로그램의 출력으로 리다이렉트 시킨다면 <code>echo ls</code> 이 종료되었을 때 함께 종료된다. 왜냐하면 입력 스트림도 종료되기 때문이다. 따라서 파이프 <code>|</code> 로 입력을 전달받은 쉘이 종료되지 않기 위하여 입력받은 데이터를 출력해주는 역할을 하는 <code>cat</code> 명령어를 함께 사용해야 한다. 다음의 명령어를 실행해보자. </p>
<div class="highlight"><pre><span></span><code><span class="o">(</span><span class="nb">echo</span> ls<span class="p">;</span>cat<span class="o">)</span> <span class="p">|</span> bash
</code></pre></div>
<p>그렇기 때문에 만약 <code>innocent</code> 변수를 덮어 썼을 때 루트 권한의 쉘이 얻어진다면 먼저 출력 프로그램과 <code>cat</code> 을 세미콜론과 괄호로 묶고 하나의 프로그램 처럼 여겨지게 해야 한다. 그러면 출력 프로그램이 종료되어도 <code>cat</code> 은 종료되지 않고 출력을 입력으로 리다이렉트 시켜주기 때문에 입력 스트림이 종료되지 않는다. 그래서 다음과 같이 <code>innocent</code> 를 덮어쓰면 된다. </p>
<div class="highlight"><pre><span></span><code><span class="o">(</span>python -c <span class="s2">"print 'x'*140 + 'aaaa'"</span><span class="p">;</span>cat<span class="o">)</span> <span class="p">|</span> ./bof
</code></pre></div>
<p><code>bof2</code> 권한으로 쉘이 열리면 <code>bof2.pw</code> 를 읽으면 된다. </p>
<p><img alt="" src="https://user-images.githubusercontent.com/16812446/72610610-2ac41980-396b-11ea-9288-612a9320b066.png"/></p>
<h3 id="_9">만약 메인함수 인자로 입력을 받는다면?<a class="headerlink" href="#_9" title="Permanent link">¶</a></h3>
<ul>
<li>
<p>이 경우는 <code>main</code> 함수에서 <code>argv[1]</code> 의 값을 가져와서 <code>strcpy</code> 함수를 사용하여 <code>buf</code> 에 복사하는 경우이다. 보통 다음과 같이 입력값이 전달된다. </p>
<p><code>./bof aaaaaaaaaa</code></p>
</li>
<li>
<p>그래서 인자에 쓰레기 값 <code>140</code> 바이트를 전달하면 <code>innocent</code> 변수 직전까지 닿을 것이고 그 <code>140</code> 바이트 이후에 어떤 값을 입력하면 <code>innocent</code> 변수를 덮어쓸 수 있게 된다. </p>
<div class="highlight"><pre><span></span><code>./bof <span class="sb">`</span>python -c <span class="s2">"print 'a'*140 + 'xxxx'"</span><span class="sb">`</span>
</code></pre></div>
</li>
</ul>
<h2 id="bof2-bof4">bof2 ~ bof4 풀어보기<a class="headerlink" href="#bof2-bof4" title="Permanent link">¶</a></h2>
<ul>
<li>
<p><code>bof2</code> 의 비밀번호를 알아내었으니 <code>bof2</code> 유저로 접속하고 <code>bof3</code> 의 비밀번호를 파헤쳐보세요. </p>
</li>
<li>
<p>그리고 <code>bof4</code> 까지 풀어보세요. </p>
</li>
<li>
<p>정답은 각각의 소스코드에 주석처리 되어 있습니다. </p>
</li>
</ul>
<hr/>
<h3 id="_10">과제<a class="headerlink" href="#_10" title="Permanent link">¶</a></h3>
<p><a href="HW-6/">HW-6.md</a> 파일의 지시를 따르는 것이 과제이다. (발표를 하며 설명을 할 수 있어야 합니다)</p>
</article>
</div>
</div>
<a class="md-top md-icon" data-md-component="top" data-md-state="hidden" href="#">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path></svg>
            Back to top
          </a>
</main>
<!-- 
<footer class="md-footer">
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        
      </div>
      
    </div>
  </div>
</footer> -->
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.top", "header.autohide"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.409db549.min.js", "version": null}</script>
<script src="../../assets/javascripts/bundle.756773cc.min.js"></script>
<script src="../../javascripts/highlight.min.js"></script>
<script src="../../javascripts/config.js"></script>
<script src="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/katex@latest/dist/contrib/auto-render.min.js"></script>
<script src="../../javascripts/b27b3e6448.js"></script>
</body>
</html>